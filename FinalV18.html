<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø§Ø´Ø¯ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ================== CSS ================== */
body { 
    font-family: 'Cairo', sans-serif; 
    direction: rtl; 
    margin: 0; 
    background: #f4f7f9; 
    color: #333;
    padding-top: 80px; 
}
header {
    position: fixed; 
    top: 0; 
    width: 100%; 
    background: #1c4587; 
    color: white; 
    text-align: center; 
    padding: 20px 0; 
    font-size: 24px; 
    font-weight: 700; 
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); 
    z-index: 1000;
}
.container {
    max-width: 1200px; 
    margin: 20px auto; 
    padding: 15px; 
}
.card {
    background: white;
    padding: 30px; 
    margin-bottom: 25px; 
    border-radius: 15px; 
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08); 
}
h2 {
    color: #1c4587; 
    border-bottom: 2px solid #e0e6ec; 
    padding-bottom: 15px;
    margin-top: 0;
    font-size: 22px;
}
input, button {
    font-family: 'Cairo', sans-serif;
}
.add-form input {
    padding: 14px 15px; 
    margin: 10px 0; 
    width: 100%; 
    box-sizing: border-box; 
    border-radius: 10px; 
    border: 1px solid #c9d2db; 
    font-size: 16px;
    transition: border-color 0.3s;
}
.add-form input:focus {
    border-color: #1c4587;
    outline: none;
}
#addProductButton {
    background: #059669; 
    color: white; 
    border: none; 
    cursor: pointer; 
    padding: 16px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    margin-top: 15px;
    transition: background 0.3s;
}
#addProductButton:hover { background: #047857; }
#searchInput {
    margin-bottom: 20px;
    background: #f9f9f9;
    border: 1px solid #c9d2db;
    border-radius: 10px;
    padding: 12px 15px;
    width: 100%;
    box-sizing: border-box;
}
#productsTable {
    width: 100%; 
    border-collapse: collapse; 
    border-spacing: 0;
}
#productsTable th, #productsTable td {
    padding: 15px; 
    text-align: center;
    border-bottom: 1px solid #e0e6ec;
}
#productsTable td { font-size: 17px; }
#productsTable th {
    background: #3b82f6; 
    color: white; 
    font-size: 15px;
}
#productsTable tr:nth-child(even) { background: #f8f9fa; }
td[contenteditable="true"] { background: #e6f7ff; border-radius: 4px; border: 1px dashed #40a9ff; color: #000; }

/* Toggle switch */
.switch { position: relative; display: inline-block; width: 60px; height: 34px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ef4444; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: #10b981; }
input:checked + .slider:before { transform: translateX(26px); }

/* Action dropdown */
.action-cell { position: relative; width: 100px; }
.options-btn { background: #1c4587; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 20px; transition: background 0.3s; }
.options-dropdown { display: none; position: absolute; right: 50%; transform: translateX(50%); top: 100%; margin-top: 5px; background: white; min-width: 140px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 50; border-radius: 8px; overflow: hidden; text-align: right; }
.options-dropdown button { display: block; width: 100%; padding: 12px; border: none; background: none; text-align: right; cursor: pointer; font-size: 14px; }
.options-dropdown button:hover { background: #e0e6ec; }
.options-dropdown .save-btn-dd { color: #10b981; }
.options-dropdown .delete-btn-dd { color: #ef4444; }

/* Mobile */
@media screen and (max-width: 768px) {
    #productsTable thead { display: none; }
    #productsTable tr { margin-bottom: 15px; border-radius: 10px; display: block; }
    #productsTable td { display: block; padding: 10px; text-align: right; position: relative; }
    #productsTable td:before { content: attr(data-label); font-weight: bold; color: #1c4587; display: inline-block; width: 40%; }
    .action-cell { width: 100%; padding: 10px 15px !important; }
}
</style>
</head>
<body>
<header>Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø§Ø´Ø¯ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</header>
<div class="container">

    <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
    <div id="addProductSection" class="card">
        <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
        <div class="add-form">
            <input type="text" id="productName" placeholder="ğŸ“ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="text" id="brand" placeholder="ğŸ·ï¸ Ø§Ù„Ù…Ø§Ø±ÙƒØ©">
            <input type="text" id="searchKey" placeholder="ğŸ”‘ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¨Ø­Ø«"> 
            <input type="number" id="wholesalePrice" placeholder="ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©">
            <input type="number" id="repairPrice" placeholder="ğŸ› ï¸ Ø³Ø¹Ø± Ø§Ù„ØªØµÙ„ÙŠØ­">
            <button id="addProductButton" onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯</button>
        </div>
    </div>
    
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div class="card">
        <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</h2>
        <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø§Ù„Ø¨Ø­Ø«..." onkeyup="searchProduct()">
        <table id="productsTable">
            <thead>
                <tr>
                    <th>Ø§Ù„ØªÙˆÙØ±</th> 
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„Ù…Ø§Ø±ÙƒØ©</th>
                    <th>Ù…ÙØªØ§Ø­ Ø§Ù„Ø¨Ø­Ø«</th> 
                    <th>Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©</th>
                    <th>Ø³Ø¹Ø± Ø§Ù„ØªØµÙ„ÙŠØ­</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th> 
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ================== Firebase ==================
const firebaseConfig = {
    apiKey: "AIzaSyBpt495yhuoTbjunCLIFCF_8c1NesxZHWs",
    authDomain: "shopweb-3466b.firebaseapp.com",
    databaseURL: "https://shopweb-3466b-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "shopweb-3466b",
    storageBucket: "shopweb-3466b.appspot.com",
    messagingSenderId: "41811528812",
    appId: "1:41811528812:web:618f240f8106f218a8dc49",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================== Helper Functions ==================
function formatNumber(num) {
    if (!num) return '';
    return Number(num).toLocaleString('en-US', { maximumFractionDigits: 0 });
}
function cleanNumber(text) {
    if (!text) return 0;
    return text.toString().replace(/,/g,'').trim();
}

// ================== CRUD ==================
function createProductRow(product, key, tbody){
    const row = tbody.insertRow();
    row.setAttribute('data-key', key);

    // Ø§Ù„ØªÙˆÙØ±
    const availableCell = row.insertCell(0); 
    availableCell.setAttribute('data-label','Ø§Ù„ØªÙˆÙØ±');
    const label = document.createElement('label'); label.className='switch';
    const input = document.createElement('input'); input.type='checkbox'; input.checked = product.isAvailable===true||product.isAvailable==='true';
    input.onclick = e=>toggleAvailability(e,key);
    const slider = document.createElement('span'); slider.className='slider';
    label.appendChild(input); label.appendChild(slider); availableCell.appendChild(label);

    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const cells = ['name','brand','searchKey','wholesale','repair'];
    cells.forEach((field,i)=>{
        const cell = row.insertCell(i+1);
        let value = product[field]||'';
        if(field==='wholesale'||field==='repair') value=formatNumber(value);
        cell.innerText=value;
        cell.contentEditable="true";
        cell.setAttribute('data-label',field==='name'?'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬':field==='brand'?'Ø§Ù„Ù…Ø§Ø±ÙƒØ©':field==='searchKey'?'Ù…ÙØªØ§Ø­ Ø§Ù„Ø¨Ø­Ø«':field==='wholesale'?'Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©':'Ø³Ø¹Ø± Ø§Ù„ØªØµÙ„ÙŠØ­');
    });

    // Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
    const actionCell = row.insertCell(6); actionCell.className='action-cell';
    const btn = document.createElement('button'); btn.className='options-btn'; btn.innerText='âš™ï¸';
    btn.onclick = e=>{e.stopPropagation(); toggleOptionsMenu(key);}
    actionCell.appendChild(btn);

    const dropdown = document.createElement('div'); dropdown.className='options-dropdown'; dropdown.id=`dropdown-${key}`;
    const saveBtn=document.createElement('button'); saveBtn.innerText='ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'; saveBtn.className='save-btn-dd'; saveBtn.onclick=()=>saveProduct(key);
    const deleteBtn=document.createElement('button'); deleteBtn.innerText='ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬'; deleteBtn.className='delete-btn-dd'; deleteBtn.onclick=()=>deleteProduct(key,product.name);
    dropdown.appendChild(saveBtn); dropdown.appendChild(deleteBtn); actionCell.appendChild(dropdown);
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function displayProducts(){
    const tbody = document.querySelector('#productsTable tbody');
    tbody.innerHTML='';
    db.ref('products').once('value',snap=>{
        const products = snap.val();
        if(!products){tbody.innerHTML='<tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯.</td></tr>'; return;}
        Object.keys(products).forEach(k=>createProductRow(products[k],k,tbody));
    });
}

// Ø§Ù„Ø¨Ø­Ø«
function searchProduct(){
    const query = document.getElementById('searchInput').value.toLowerCase().trim();
    const tbody=document.querySelector('#productsTable tbody');
    tbody.innerHTML='';
    db.ref('products').once('value',snap=>{
        const products=snap.val(); if(!products){tbody.innerHTML='<tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯.</td></tr>'; return;}
        let found=false;
        Object.keys(products).forEach(k=>{
            const p=products[k];
            if((p.searchKey||'').toLowerCase().includes(query)){ createProductRow(p,k,tbody); found=true; }
        });
        if(!found) tbody.innerHTML='<tr><td colspan="7">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</td></tr>';
    });
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
function addProduct(){
    const name=document.getElementById('productName').value.trim();
    const brand=document.getElementById('brand').value.trim();
    const searchKey=document.getElementById('searchKey').value.trim();
    const wholesale=cleanNumber(document.getElementById('wholesalePrice').value);
    const repair=cleanNumber(document.getElementById('repairPrice').value);
    if(!name||!brand||!searchKey||!wholesale||!repair){alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return;}
    db.ref('products').push({name,brand,searchKey,wholesale:Number(wholesale),repair:Number(repair),isAvailable:true})
    .then(()=>{document.getElementById('productName').value=''; document.getElementById('brand').value=''; document.getElementById('searchKey').value=''; document.getElementById('wholesalePrice').value=''; document.getElementById('repairPrice').value=''; displayProducts(); alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');})
    .catch(e=>alert('Ø­Ø¯Ø« Ø®Ø·Ø£: '+e.message));
}

// Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
function saveProduct(key){
    const row=document.querySelector(`tr[data-key="${key}"]`); if(!row){alert('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬'); return;}
    const data={};
    data.name=row.cells[1].innerText.trim();
    data.brand=row.cells[2].innerText.trim();
    data.searchKey=row.cells[3].innerText.trim();
    data.wholesale=Number(cleanNumber(row.cells[4].innerText));
    data.repair=Number(cleanNumber(row.cells[5].innerText));
    db.ref('products/'+key).update(data).then(()=>alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'));
}

// Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬
function deleteProduct(key,name){
    if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬: ${name}?`)){ db.ref('products/'+key).remove().then(displayProducts); }
}

// Ø§Ù„ØªÙˆÙØ±
function toggleAvailability(e,key){ const status=e.target.checked; db.ref('products/'+key).update({isAvailable:status}); }

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
let activeDropdown=null;
function toggleOptionsMenu(key){
    if(activeDropdown && activeDropdown!==key) document.getElementById(`dropdown-${activeDropdown}`).style.display='none';
    const dropdown=document.getElementById(`dropdown-${key}`);
    dropdown.style.display=(dropdown.style.display==='block'?'none':'block');
    activeDropdown=(dropdown.style.display==='block')?key:null;
}
document.addEventListener('click',()=>{if(activeDropdown){document.getElementById(`dropdown-${activeDropdown}`).style.display='none'; activeDropdown=null;}});

// ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.onload=()=>{displayProducts();};
</script>
</body>
</html>